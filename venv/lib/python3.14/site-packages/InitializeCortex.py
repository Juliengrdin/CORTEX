import sys
import os
from pathlib import Path

def setup_path():
    """
    Searches for the project root by looking for 'CORTEX.py' 
    and adds it to sys.path.
    """
    # Start at the file invoking this function
    # We use inspection because __file__ here would be cortex_link.py itself
    import inspect
    try:
        frame = inspect.stack()[1]
        start_path = Path(frame.filename).resolve()
    except:
        start_path = Path.cwd()

    current = start_path
    
    # Walk up until we find the marker file 'CORTEX.py'
    while current != current.parent:
        if (current / "CORTEX.py").exists():
            if str(current) not in sys.path:
                sys.path.insert(0, str(current))
                print(f"CORTEX Root linked: {current}")
            return
        current = current.parent

    print("Error: Could not find CORTEX root directory.")

setup_path()
